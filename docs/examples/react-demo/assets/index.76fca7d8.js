var N=Object.defineProperty,q=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var E=(n,r,o)=>r in n?N(n,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[r]=o,S=(n,r)=>{for(var o in r||(r={}))M.call(r,o)&&E(n,o,r[o]);if(B)for(var o of B(r))O.call(r,o)&&E(n,o,r[o]);return n},v=(n,r)=>q(n,A(r));import{R as L,r as l,j as e,M as K,L as P,C as _,a as m,B as h,b as y,c as k,d as j,e as R,F,S as U,f as x,I as C,g as $}from"./vendor.29d92bc4.js";const J=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function o(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(t){if(t.ep)return;t.ep=!0;const s=o(t);fetch(t.href,s)}};J();const w=L.createContext(),g=L.createContext(),T=({open:n,box:r})=>y(k,{container:!0,justifyContent:"space-between",alignItems:"center",className:"box-title",children:[y(j,{children:[r.ID,e(R,{dot:!0,color:r.SdnboxState===1?"primary":"red"})]}),e("div",{style:{float:"right"},children:n?"\u6536\u8D77":"\u5C55\u5F00"})]}),V=({camera:n,sdnboxId:r})=>{const o=l.exports.useContext(g),a=l.exports.useRef(null),[t,s]=l.exports.useState(null),[u,c]=l.exports.useState(0),d=l.exports.useRef(null),[p,b]=l.exports.useState(()=>({cameraId:n.ID,sdnboxId:r}));l.exports.useEffect(()=>{if(!!a.current){try{d.current=o.play(a.current,v(S({},p),{fill:!0}),{onError:i=>{s(i),c(f=>f+1)},onRestore:()=>{s(null),c(0)}}),d.current.start()}catch(i){K.error(i+""),console.error(i)}return()=>{var i,f;(i=d.current)==null||i.stop(),(f=d.current)==null||f.destroy(),d.current=null}}},[p]);const I=l.exports.useCallback(()=>{var i;(i=d.current)==null||i.stats().then(f=>{console.log(f),f.forEach(console.log)})},[]);return y(k,{container:!0,direction:"column",alignItems:"center",justifyContent:"center",spacing:"lg",children:[e("div",{ref:a,style:{width:"100%",height:"400px",boxShadow:t?"red 0px 0px 5px 1px":"green 0px 0px 5px 1px"}}),y(j,{children:[e(h,{onClick:I,children:"Stats"}),e(C,{id:"urlInput",style:{width:"200px"}}),e(h,{onClick:()=>{const i=document.getElementById("urlInput").value;b({url:i})},styleType:"primary",children:"Play URL"})]}),t&&y("p",{children:[t+"",", \u91CD\u8BD5\u7B2C ",u," \u6B21"]})]})},H=({camera:n,sdnboxId:r,onClose:o})=>e(m,{visible:!0,onClose:o,children:e(m.Content,{children:e(V,{camera:n,sdnboxId:r})})}),z=({camera:n,sdnboxId:r})=>{const o=l.exports.useContext(g),[a,t]=l.exports.useState(!1),{onUpdate:s}=l.exports.useContext(w),[u,c]=l.exports.useState(!1),d=l.exports.useCallback(async I=>{t(!0);try{I?await o.startSdnboxCameraPushing({sdnboxId:r,cameraId:n.ID}):await o.stopSdnboxCameraPushing({sdnboxId:r,cameraId:n.ID}),s()}catch(D){K.error(D+"")}finally{t(!1)}},[]),p=l.exports.useCallback(()=>{c(!1)},[]),b=l.exports.useCallback(()=>{c(!0)},[]);return y(F,{children:[e(P,{loading:a,children:y(k,{container:!0,justifyContent:"space-between",alignItems:"center",className:"camera",children:[e("div",{children:n.ID}),y(j,{children:[e(h,{onClick:b,children:"\u64AD\u653E"}),e(U,{checked:n.Status===1,onChange:d})]})]})}),u&&e(H,{onClose:p,camera:n,sdnboxId:r})]})},G=()=>{const n=l.exports.useContext(g),[r,o]=l.exports.useState(!1),[a,t]=l.exports.useState([]),s=l.exports.useCallback(async()=>{o(!0);try{const c=await n.getSdnboxCameraList();t(c)}catch(c){K.error(c+"")}finally{o(!1)}},[]);l.exports.useEffect(()=>{s()},[]);const u=l.exports.useCallback(()=>{s()},[]);return e(w.Provider,{value:{onUpdate:u},children:e(P,{loading:r,style:{minHeight:"300px"},children:e(_,{multiple:!1,children:a.length?e("div",{className:"box-list",children:a.map(c=>{var d;return e(_.Panel,{panelKey:c.ID,className:"box-item",title:p=>e(T,v(S({},p),{box:c})),children:e("div",{children:((d=c.Camera)==null?void 0:d.length)?c.Camera.map(p=>e(z,{sdnboxId:c.ID,camera:p},p.ID)):e("div",{children:"\u65E0\u6444\u50CF\u5934"})})},c.ID)})}):e("div",{children:"\u76D2\u5B50\u5217\u8868\u4E3A\u7A7A"})})})})},Q=({onSubmit:n})=>{l.exports.useEffect(()=>{const o=localStorage.getItem("lastInput"),a=(t,s)=>document.querySelector(`#${t}`).value=s;if(o){const{publicKey:t,privateKey:s,projectId:u}=JSON.parse(o);a("publicKey",t),a("privateKey",s),a("projectId",u)}},[]);const r=l.exports.useCallback(o=>{const a=s=>document.querySelector(`#${s}`).value,t={publicKey:a("publicKey"),privateKey:a("privateKey"),projectId:a("projectId")};localStorage.setItem("lastInput",JSON.stringify(t)),n(t)},[]);return y(x,{id:"form",onSubmit:r,children:[e(x.Item,{label:"publicKey",children:e(C,{required:!0,block:!0,id:"publicKey"})}),e(x.Item,{label:"privateKey",children:e(C,{required:!0,block:!0,id:"privateKey"})}),e(x.Item,{label:"projectId",children:e(C,{required:!0,block:!0,id:"projectId"})})]})},W=({onSubmit:n})=>{const r=l.exports.useCallback(()=>{document.querySelector("#form").requestSubmit()},[]),o=l.exports.useCallback(a=>{const t=u=>document.querySelector(`#${u}`).value,s={publicKey:t("publicKey"),privateKey:t("privateKey"),projectId:t("projectId")};localStorage.setItem("lastInput",JSON.stringify(s)),n(s)},[]);return e(m,{visible:!0,footer:e(h,{styleType:"primary",onClick:r,children:"\u786E\u5B9A"}),closable:!1,children:e(m.Content,{children:e(Q,{onSubmit:o})})})};function X(){const[n,r]=l.exports.useState(!0),[o,a]=l.exports.useState(null),t=l.exports.useCallback(s=>{a(UBoxAuto(s,{debug:!0})),r(!1)},[]);return n?e(W,{onSubmit:t}):e(g.Provider,{value:o,children:e(G,{})})}$.render(e(X,{}),document.getElementById("root"));
